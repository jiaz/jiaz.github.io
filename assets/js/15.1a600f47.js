(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{281:function(s,t,n){"use strict";n.r(t);var a=n(5),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"why-my-node-program-won-t-exit"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#why-my-node-program-won-t-exit"}},[s._v("#")]),s._v(" Why my node program won't exit?!")]),s._v(" "),n("p",[s._v("上周碰到一个很有意思的问题，同事找我来跑一个node的程序，结果跑完了最后一个step，但是程序没有退出。")]),s._v(" "),n("p",[s._v("这对刚从同步编程世界转过来的同学来说简直是不可思议的事情。刚开始我也以为是程序的bug，如果不是bug的话有可能是在等待某个callback，但一直没有触发，同事也不明白是为什么，正好我刚入职就让我investigate一下。之前虽然写过一些node的程序，但是都是小打小弄，所以刚开始没什么头绪。")]),s._v(" "),n("p",[s._v("因为node没有什么特别好的debug工具（至少我不熟悉），黔驴技穷使出老办法，comment代码看效果。这个程序的特点是，程序本身比较简单，但是引用了一大堆的模块，所以我先确定程序本身不是造成hang住的原因，办法很简单，把有用的逻辑全部注释掉，结果发现程序什么都不干也会hang住。所以问题就在那些require的模块上了。接下来就是二分查找注释一部分模块看效果，然后递归查找，最后定位在两个模块上。发现这两个模块都调用了setInterval这个函数，恍然大悟原来timer会block main函数的退出。")]),s._v(" "),n("p",[s._v("那么作为一个码农，光知道表面原因是不够的，所以跟着就产生了三个问题:")]),s._v(" "),n("ol",[n("li",[s._v("为什么timer能block程序的退出？")]),s._v(" "),n("li",[s._v("除了timer，还有没有其他东西会block？比如我之前说到的callback（这个我是知道的，因为之前碰到过没有callback程序不退出的情况）。")]),s._v(" "),n("li",[s._v("如何方便地检测到block程序退出的原因？下次碰到同样的问题我可不想再二分查找了。")])]),s._v(" "),n("p",[s._v("平时活比较多，趁周末有时间就研究了一下。")]),s._v(" "),n("p",[s._v("要知道为什么程序被block了，那首先得知道你的程序在干什么。这就牵涉到了nodejs的程序的生命周期，程序是如何bootstrap的，js模块是如何被加载的，eventloop是如何实现的。很遗憾nodejs的debugger只能看到js的space，不知道程序底层究竟在做啥，而且网上相关的资料少之又少，所以只好把代码下载下来自己看。好在node的代码量不是非常多，写的也还算整洁，所以花了点时间还是能大致看懂的。为了方便以后有同样需求的同学，总结一下node bootstrap的过程，以及eventloop的处理。")]),s._v(" "),n("p",[s._v("下面我大概节选一些代码做一些注解，方便起见我过滤掉了windows相关的代码。当然我也没有完全看懂，因为c++程序的特点是短时间内不太可能看懂...但是大致的逻辑应该是明确的。")]),s._v(" "),n("p",[s._v("整个node程序的入口是node_main.cc:")]),s._v(" "),n("div",{staticClass:"language-cpp line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[s._v("# 以下代码节选自"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("36.")]),s._v("release版本\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UNIX")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" node"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("可以看到入口很简单，调用了"),n("code",[s._v("node::Start")]),s._v("这个函数进行处理。"),n("code",[s._v("node::Start")]),s._v("这个函数定义在node.cc中。")]),s._v(" "),n("div",{staticClass:"language-cpp line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 略去了一些不重要的...")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 初始化信号处理，libuv")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// This needs to run *before* V8::Initialize()")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Use copy here as to not modify the original argv:")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" argv_copy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 初始化v8引擎")]),s._v("\n  V8"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Locker locker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    HandleScope handle_scope"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Create the one and only Context.")]),s._v("\n    Persistent"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Context"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" context "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Context"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("New")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    Context"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Scope "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("context_scope")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 初始化process这个对象，这个很重要，建议把代码下载下来看一下，")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 里面可以发现一些没有document的方法哦")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Use original argv, as we're just copying values out of it.")]),s._v("\n    Handle"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Object"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" process_l "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("SetupProcessObject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    v8_typed_array"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("AttachBindings")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Global")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. Load方法会载入node.js这个模块，该模块返回一个方法，这个方法会根据命令行提供的参数")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 载入所有的js模块，很重要")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Create all the objects, load modules, do everything.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// so your next reading stop should be node::Load()!")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Load")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process_l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 进入runloop，也就是eventloop。这个eventloop是libuv实现的，是node的核心机制")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// uv_run内部是一个while循环，直到没有消息处理才会退出。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// All our arguments are loaded. We've evaluated all of the scripts. We")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// might even have created TCP servers. Now we enter the main eventloop. If")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// there are no watchers on the loop (except for the ones that were")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// uv_unref'd) then this function exits. As long as there are active")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// watchers, it blocks.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv_run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv_default_loop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" UV_RUN_DEFAULT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("EmitExit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process_l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("RunAtExit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br")])]),n("p",[s._v("OK，上面这段很短的代码就非常重要了，它里面有整个node的核心运作机制，包括v8引擎的初始化，libuv eventloop的初始化，js模块的载入，以及eventloop的处理逻辑。Load函数会载入node.js这个模块，这个模块是存放在node_natives.h（build的时候会生成）中的一个string。其核心内容是"),n("code",[s._v("startup()")]),s._v("这个函数。因为太长了我就不贴了，里面最关键的是调用了"),n("code",[s._v("Module.runMain()")]),s._v("这个函数，定义在module.js中")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// bootstrap main module.")]),s._v("\nModule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("runMain")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Load the main module--the command line argument.")]),s._v("\n  Module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("_load")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Handle any nextTicks added in the first tick of the program")]),s._v("\n  process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("_tickCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("可以看到，它会把传入的第一个参数，作为模块去加载，这时候才真正hit到了你写的代码。")]),s._v(" "),n("p",[s._v("node会把js模块加载时同步运行的代码都执行完，直到hit到一个异步调用或者是全部运行完毕，这时候Load函数就会返回，然后就进入了"),n("code",[s._v("uv_run")]),s._v("这个函数。")]),s._v(" "),n("p",[n("code",[s._v("uv_run")]),s._v("是一个很短的函数，贴在下面。")]),s._v(" "),n("div",{staticClass:"language-cpp line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv_run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uv_loop_t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" uv_run_mode mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" timeout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  r "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__loop_alive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" loop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("stop_flag "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("UV_TICK_START")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__update_time")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__run_timers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__run_idle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__run_prepare")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__run_pending")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    timeout "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" UV_RUN_NOWAIT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      timeout "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv_backend_timeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__io_poll")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" timeout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__run_check")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__run_closing_handles")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    r "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__loop_alive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("UV_TICK_STOP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UV_RUN_ONCE "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" UV_RUN_NOWAIT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* The if statement lets gcc compile it to a conditional store. Avoids\n   * dirtying a cache line.\n   */")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("stop_flag "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    loop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("stop_flag "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("p",[s._v("可以看到逻辑很简单，首先调用"),n("code",[s._v("uv__loop_alive()")]),s._v("检查while是否需要继续（看来"),n("code",[s._v("uv__loop_alive")]),s._v("就是我们要找的东西了！）。然后在while loop中处理各种事件。（建议可以看一下"),n("code",[s._v("uv_backend_timeout")]),s._v("这个函数，这个函数根据timer来估计下一次poll的timeout时间，里面可以看到node的timer是怎么实现的）")]),s._v(" "),n("p",[s._v("所以程序不退出的原因就是"),n("code",[s._v("uv__loop_alive()")]),s._v("返回了"),n("code",[s._v("true")]),s._v("。看下这个函数")]),s._v(" "),n("div",{staticClass:"language-cpp line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__loop_alive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uv_loop_t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__has_active_handles")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uv__has_active_reqs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n         loop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("closing_handles "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("应该能看懂了，这个函数会检查active的handle或者request，在libuv中，handle是事件处理对象的统称，而request那就是事件啦。所以程序不退出就两个原因，有handler活跃或者是有request没处理完。")]),s._v(" "),n("p",[s._v("好了，这时候我们大致已经知道了问题1、2的答案，那么问题3怎么解决，以后怎么处理类似的问题，二分查找是在太痛苦了，最好是能有一个方法知道当前的active handler和request咯。好吧，经过一番查找，原来node已经提供了这两个方法了。。。但是竟然你妹的没有写到doc里。。。定义在node.cc中：")]),s._v(" "),n("div",{staticClass:"language-cpp line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// define various internal methods")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NODE_SET_METHOD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_getActiveRequests"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" GetActiveRequests"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NODE_SET_METHOD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_getActiveHandles"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" GetActiveHandles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("我知道了这两个方法去Google了一下，发现才800个搜索结果。。。怪不得之前一直找不到类似的文章。")]),s._v(" "),n("p",[s._v("知道了大招当然要试一下，祭出node-debug神器，在command line里调用之前会hang住的程序，为了方便我把一些内容抹掉了。。请自行想像。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ node-debug xxx.js\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("程序hang住后，pause程序。")]),s._v(" "),n("p",[s._v("然后在console中调用"),n("code",[s._v("process._getActiveHandlers()")]),s._v("，voila! 然后调用stop, close, whatever方法，你的程序就正常退出啦！")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/nodehang2.png",alt:"找到了！"}})]),s._v(" "),n("p",[s._v("好了，问题圆满解决，后来想想可能google得当能解决更快些，但是看了这些代码之后能对node有更多的了解，整个过程还是很有价值的。")]),s._v(" "),n("p",[s._v("最后是copyright部分，以上代码都是摘自nodejs源码，附上许可。")]),s._v(" "),n("div",{staticClass:"language-cpp line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Copyright Joyent, Inc. and other Node contributors.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Permission is hereby granted, free of charge, to any person obtaining a")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// copy of this software and associated documentation files (the")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// "Software"), to deal in the Software without restriction, including')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// without limitation the rights to use, copy, modify, merge, publish,")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// distribute, sublicense, and/or sell copies of the Software, and to permit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// persons to whom the Software is furnished to do so, subject to the")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// following conditions:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The above copyright notice and this permission notice shall be included")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// in all copies or substantial portions of the Software.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// USE OR OTHER DEALINGS IN THE SOFTWARE.")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);